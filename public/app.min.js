!function(){'use strict';const t=document.getElementById('counterDisplay');let e=!1;function n(){const t=document.getElementById('backgroundMusic');if(!t)return;t.volume=.4;const n=localStorage.getItem('fresko_music_muted');if('true'===n){t.muted=!0;document.getElementById('soundToggle').classList.add('muted');e=!1}document.addEventListener('click',function(){t.play().catch(()=>{})}),document.addEventListener('touchstart',function(){t.play().catch(()=>{})}),setTimeout(()=>{t.play().catch(()=>{})},500),document.getElementById('soundToggle').addEventListener('click',function(){e=!e,t.muted=!e,localStorage.setItem('fresko_music_muted',!e?'true':'false'),this.classList.toggle('muted',!e)})}function o(){const t=document.querySelector('.avatar-video'),e=document.querySelector('.avatar-image');t&&e&&(setTimeout(()=>{t.readyState<2&&(t.style.display='none',e.style.display='block')},3e3),t.addEventListener('error',()=>{t.style.display='none',e.style.display='block'}))}function r(t){const e=document.getElementById('counterDisplay');if(!e)return;e.innerHTML='';let n=t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,' ').split('');for(;n.length<3;)n.unshift('0');n.forEach((t,o)=>{const c=document.createElement('div');c.className='digit',c.textContent=t,setTimeout(()=>{c.classList.add('new'),setTimeout(()=>c.classList.remove('new'),300)},100*o),e.appendChild(c)})}async function c(){try{t&&(t.innerHTML='<div class="loading-text">Загрузка...</div>');const e=await fetch('/api/counter',{method:'POST'});if(!e.ok)throw new Error('Server error');const n=await e.json();r(n.count)}catch(e){console.error('Counter error:',e);const n=localStorage.getItem('fresko_local_counter'),o=n?parseInt(n)+1:1;localStorage.setItem('fresko_local_counter',o),r(o)}}document.addEventListener('DOMContentLoaded',()=>{n(),o(),c(),window.addEventListener('beforeunload',()=>{const t=document.getElementById('backgroundMusic');t&&t.pause()})})}();